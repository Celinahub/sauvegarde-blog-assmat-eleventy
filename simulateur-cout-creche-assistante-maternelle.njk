---
layout: layouts/base.njk
title: "Co√ªt cr√®che vs assistante maternelle 2025 ‚Äì Estimez en ligne"
description: "Comparez le reste √† charge entre assistante maternelle, cr√®che PSU et PAJE gr√¢ce au 1er simulateur comparatif en ligne 2025."
url: "https://chubert91assmat.netlify.app/simulateur-cout-creche-assistante-maternelle/"
image: "projet-accueil-assistante-maternelle.jpg"
eleventyNavigation:
  key: SIMULATION CO√õT CR√àCHE/ASSMAT 2025
  order: 5
permalink: "/simulateur-cout-creche-assistante-maternelle/"
bodyClass: "bg-white simulateur-cout-creche-assistante-maternelle"
---

    
<!-- Ic√¥ne de d√©filement vers le haut utilisant une image SVG -->
<a href="#simulateur-reforme-cmg-assmat-creche" class="scroll-to-top">
    <img class="rocket-icon" src="../images/rocket-svgrepo-com.svg" alt="Ic√¥ne de fus√©e pour remonter en haut de la page projet d'accueil" />
</a>





<section id="simulateur-reforme-cmg-assmat-creche" class="container-fluid py-5 position-relative">

<div class="reforme-cmg-container">
        <h1 class="poppins-bold-titre-reforme-cmg">Simulateur R√©forme CMG 2025</h1>
        <a href="https://chubert91assmat.netlify.app/posts/petite-enfance-bretigny-91/choix-mode-de-garde-bretigny/#differenciation" class="btn btn-action-primary my-1" aria-label="Lire l'article sur le choix d'un mode de garde par une assistante maternelle en Essonne">
              D√©couvrir la solution gagnante qu'offre une assistante maternelle ‚Üí
            </a>
    </div>

    
        </div>
    </div>
</section>







<div class="svg-banniere-background">
     <div class="svg-container">
    <img src="{{ '/images/projet-accueil/nuage-bienvenue-pc.svg' | url }}" 
         class="nuages-bleus-curvy pc-svg" 
         alt="Illustration de nuages pour la pr√©sentation du blog sur PC"
         loading="lazy">
    
    <img src="{{ '/images/projet-accueil/nuage-bienvenue-mobile.svg' | url }}" 
         class="nuages-bleus-curvy mobile-svg" 
         alt="Illustration de nuages pour la pr√©sentation du blog sur mobile"
         loading="lazy">
</div>



<section id="comparer-creche-assistante-maternelle">
  <div class="container-service container-md">
  <h2 class="poppins-bold-service-title mb-5">COMPAREZ & ESTIMEZ</h2>

   

 <div class="row gy-4">
      <!-- Carte 1 -->
      <div class="col-12">
        <div class="comparatif-card h-100 p-4">
          <h3 class="fs-5 fw-bold poppins-regular d-flex align-items-center mb-3">
            <span class="comparatif-icon-wrapper me-2">
              <img src="{{ '/images/projet-accueil/securite/communication-assmat-bretigny.svg' | url }}" class="bien-etre-icon" alt="Ic√¥ne communication" loading="lazy">
            </span>
            Comparez les solutions pour faire le bon choix 
          </h3>
          <ul class="poppins-regular-comparatif">
          <li>Cette simulation vous aide √† y voir plus clair, mais les aides d√©pendent de votre situation personnelle, de la structure choisie et d‚Äôune confirmation par la CAF. Vos donn√©es ne sont pas conserv√©es.</li>
          <li><strong>Les micro-cr√®ches PAJE</strong> appliquent librement leur tarif horaire, g√©n√©ralement entre 9‚ÄØ‚Ç¨ et 10‚ÄØ‚Ç¨/h pour la premi√®re tranche, puis d√©gressif selon le volume horaire et la fratrie. <strong>Ce simulateur utilise une fourchette r√©aliste en Essonne, mais le tarif exact d√©pend de chaque √©tablissement.</strong> Nous vous invitons √† contacter la micro-cr√®che de votre choix pour obtenir un devis personnalis√©.</li>
          <li>
            <a href="https://www.urssaf.fr/accueil/outils-documentation/simulateurs/calculer-reste-a-charge-cmg-pe.html" target="_blank" class="styled-link">Simulateur</a> officiel URSSAF pour le CMG chez une assistante maternelle.</li>
          <li>
            <a href="https://monenfant.fr/simuler-le-cout-en-creche" target="_blank" class="styled-link">Simulateur</a> officiel CAF pour la cr√®che PSU (monenfant.fr).</li>
          </ul>

<div class="exemple-container">
  <a href="#exemples-cout-reel-assistante-maternelle" class="btn btn-action-primary">
    Consultez des exemples concrets ‚Üí
  </a>
</div>

        </div>
      </div>


     <!-- Carte 2 -->
      <div class="col-12">
        <div class="comparatif-card h-100 p-4">
          <h3 class="fs-5 fw-bold poppins-regular d-flex align-items-center mb-3">
            <span class="comparatif-icon-wrapper me-2">
              <img src="{{ '/images/simulateur/idee-simulateur-bretigny.svg' | url }}" class="idee-icon" alt="Ic√¥ne communication" loading="lazy">
            </span>
           Pourquoi proposer ce simulateur ?
          </h3>
          <ul class="poppins-regular-comparatif">
            <li><strong>Gain de temps :</strong> Comparez instantan√©ment les restes √† charge des trois modes d‚Äôaccueil, r√©unis pour la premi√®re fois sur une seule page.</li>
          <li><strong>Plus de clart√© :</strong> Les diff√©rences de calcul entre cr√®ches PSU, cr√®ches PAJE et assistantes maternelles rendent la comparaison difficile.</li>
           <li><strong>D√©cision biais√©e :</strong> Le choix du mode d‚Äôaccueil se fait rarement sur le co√ªt r√©el.</li>
          <li><strong>Id√©e re√ßue :</strong> La cr√®che semble moins ch√®re‚Ä¶ mais ce n‚Äôest pas toujours vrai.</li>
           <li><strong>Rassurer :</strong> Le salaire de l‚Äôassistante maternelle peut sembler √©lev√©, mais comme l‚Äôillustrent les exemples ci-dessous, le reste √† charge, indemnit√©s comprises, peut √™tre proche du co√ªt d‚Äôune place en cr√®che PSU selon votre situation familiale.</li>
           <li><strong>Tarifs justes et adapt√©s :</strong> Ce simulateur me permet d‚Äôajuster mes tarifs pour qu‚Äôils restent coh√©rents avec les autres solutions d‚Äôaccueil propos√©es aux familles du secteur, √† condition d'assurer la p√©rennit√© de mon activit√©.</li>
          </ul>

        </div>
      </div>


    <div class="row">
      <div class="container my-5">

       
      <h2 class="poppins-regular-simulateur mb-5">
  Simulateur CMG 2025 ‚Äì une solution adapt√©e √† mon profil
</h2>







  <form id="simulateur-form" class="row g-4">
  <!-- Situation familiale -->
  <div class="col-md-6">
    <label class="form-label poppins-regular-simucmg">Situation familiale</label>
    <div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="situation" value="couple" id="situationCouple" checked required>
        <label class="form-check-label poppins-regular-simucmg" for="situationCouple">Couple</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="situation" value="mono" id="situationMono" required>
        <label class="form-check-label poppins-regular-simucmg" for="situationMono">Parent isol√©</label>
      </div>
    </div>
  </div>



<div class="col-md-6">
  <label for="nbEnfants" class="form-label poppins-regular-simucmg">Nombre d‚Äôenfants √† charge</label>
  <input type="number" class="simu-control styled-input" id="nbEnfants" name="nbEnfants" min="1" max="4" required>
</div>



  <!-- Ressources -->
<div class="col-md-6">
  <label for="revenu" class="form-label poppins-regular-simucmg">Ressources annuelles 2023 (‚Ç¨)</label>
  <input 
    type="number" 
    class="simu-control styled-input" 
    id="revenu" 
    name="revenu" 
    min="0" 
    max="102000" 
    required
  >
</div>


 <!-- √Çge enfant -->
<div class="col-md-6">
  <label class="form-label poppins-regular-simucmg">√Çge de l‚Äôenfant √† garder</label>
  <div class="form-control-plaintext">0 √† 3 ans</div>
  <input type="hidden" id="ageEnfant" name="ageEnfant" value="0-3">
</div>









<div class="col-md-6">
  <label for="heuresHebdo" class="form-label poppins-regular-simucmg">Heures de garde par semaine</label>
  <input type="number" step="0.01" class="simu-control styled-input" id="heuresHebdo" name="heuresHebdo" min="0">
</div>









<div class="col-md-6">
  <label for="semainesParAn" class="form-label poppins-regular-simucmg">
    Type de contrat
  </label>
 <select class="form-select styled-select" id="semainesParAn" name="semainesParAn" required>
  <option value="" disabled selected>-- Choisissez une option --</option>
  <option value="52">52 semaines ‚Äì ann√©e compl√®te</option>
  <option value="46">46 sem. / an (hors cong√©s)</option>
    <option value="45">45 sem. / an (hors cong√©s)</option>
    <option value="44">44 sem. / an (hors cong√©s)</option>
    <option value="43">43 sem. / an (hors cong√©s)</option>
    <option value="42">42 sem. / an (hors cong√©s)</option>
    <option value="41">41 sem. / an (hors cong√©s)</option>
    <option value="40">40 sem. / an (hors cong√©s)</option>
    <option value="39">39 sem. / an (hors cong√©s)</option>
    <option value="38">38 sem. / an (hors cong√©s)</option>
    <option value="37">37 sem. / an (hors cong√©s)</option>
    <option value="36">36 sem. / an (hors cong√©s)</option>
  </select>
</div>


  <!-- Taux horaire -->
  <div class="col-md-6">
    <label for="tauxHoraire" class="form-label poppins-regular-simucmg">Taux horaire net assmat (‚Ç¨)</label>
    <input type="number" step="0.01" class="simu-control" id="tauxHoraire" name="tauxHoraire" required>
  </div>



  <!-- Indemnit√©s -->
  <div class="col-md-3">
    <label for="indemEntretien" class="form-label poppins-regular-simucmg">Indemnit√© d'entretien (‚Ç¨ / mois)</label>
    <input type="number" step="0.01" class="simu-control" id="indemEntretien" name="indemEntretien" required>
  </div>

  <div class="col-md-3">
    <label for="indemRepas" class="form-label poppins-regular-simucmg">Indemnit√© de repas (‚Ç¨ / mois)</label>
    <input type="number" step="0.01" class="simu-control" id="indemRepas" name="indemRepas" required>
  </div>







<!-- ‚¨áÔ∏è CASE √Ä COCHER -->
<div class="col-md-6">
  <div class="form-check">
    <input class="form-check-input" type="checkbox" id="connaitPrixAccueil">
    <label class="form-check-label poppins-regular-simucmg" for="connaitPrixAccueil">
     
    Tarif connu sur devis micro-cr√®che <strong>PAJE</strong>
    (Les simulateurs indiquent souvent le tarif PSU, qui ne s‚Äôapplique pas ici.)

    </label>
  </div>
</div>

<!-- ‚¨áÔ∏è CHAMP SAAISI OU AUTOCALCUL√â -->
<div class="col-md-6 d-none" id="prixAccueilWrapper">
  <label for="prixAccueil" class="form-label poppins-regular-simucmg">Montant total mensuel factur√© par la cr√®che sur devis <strong>(aide CAF non d√©duite)</strong> (‚Ç¨)</label>
  <input 
    type="number" 
    step="0.01" 
    class="simu-control styled-input" 
    id="prixAccueil" 
    name="prixAccueil"
    placeholder="Saisir un montant personnalis√©"
  >
</div>













 
  <!-- Bouton unique -->
  <div class="col-12 mb-5 text-center">
    <button type="submit" class="btn btn-simu">Voir mon profil</button>
  </div>
</form>







<!-- R√©sultat -->
<div id="result-box" class="alert mt-4 d-none" role="alert">
  <div id="result-message"></div>
</div>

<button id="btn-pdf" class="btn btn-simu mt-3 d-none">T√©l√©charger le PDF</button>
<button id="btn-reset" class="btn btn-simu mt-3 d-none">‚Üª Recommencer</button>



<!-- Barom√®tre visuel (affich√© uniquement si CMG favorable) -->
<div id="barometre-wrapper" class="my-4 d-none">



  <!-- Titre -->
  <h5 class="poppins-regular-simulateur mb-5">Barom√®tre comparatif prix</h5>
  

  <!-- Barom√®tre -->
<div id="barometre" class="position-relative" style="height: 30px; background: linear-gradient(to right, #d8dd8e, #F79927); border-radius: 15px;">
  <div id="curseur">
    
      <img src="{{ '/images/simulateur/baby-nipple-simulateur.svg' | url }}" class="curseur-tetine" alt="Ic√¥ne curseur t√™tine chez celine" />
  </div>
</div>

  <!-- L√©gende en dessous -->
  <div class="d-flex justify-content-between mt-5 px-1">
    <span class="poppins-regular-simucmg"><strong>Cr√®che PSU</strong></span>
  <span class="poppins-regular-simucmg"><strong>Micro-cr√®che PAJE</strong></span>
  </div>


<!-- Section simulateur (visible uniquement selon profil) -->
<div id="simulateur-additional" class="mt-4" style="display: none;">
  <h4>Estimation personnalis√©e</h4>
  <p>Formulaire ou √©l√©ments compl√©mentaires ici‚Ä¶</p>
</div>







        </div>
      </div>
    </div>
  </div>
</section>



<section id="calculs-automatiques-assistante-maternelle">
  <div class="container-service container-md">
  <h2 class="poppins-bold-service-title mb-5">CHIFFRES CLES</h2>

   

 <div class="row gy-4">
      <!-- Carte 3 -->
      <div class="col-12 mb-5">
        <div class="comparatif-card h-100 p-4">
          <h3 class="fs-5 fw-bold poppins-regular d-flex align-items-center mb-3">
            <span class="comparatif-icon-wrapper me-2">
              <img src="{{ '/images/simulateur/auto-simulateur-bretigny.svg' | url }}" class="bien-etre-icon" alt="Ic√¥ne communication" loading="lazy">
            </span>
           Informations g√©n√©r√©es √† partir de votre saisie
          </h3>


  
          
         <!-- Carte des calculs automatiques -->
<div class="col-12">


  <div class="comparatif-card h-100 p-4">
   
 <p class="poppins-regular-simucmg mb-3">
    <strong>Contrairement aux micro-cr√®ches PAJE souvent au forfait annuel, les cr√®ches PSU et les assistantes maternelles peuvent proposer des contrats plus souples, adapt√©s au nombre r√©el de semaines de garde souhait√©es.</strong>
    </p>



<!-- Heures -->
 <div class="col-md-6 mb-3">
  <label for="heuresMensuelles" class="form-label poppins-regular-simucmg">
    Heures de garde par mois (Assmat / Cr√®che PSU)
  </label>
  <input
    type="number"
    class="simu-auto-control"
    id="heuresMensuelles"
    name="heuresMensuelles"
    step="0.01"
    readonly
  >

  <!-- Heures mensuelles PSU (non affich√©es, mais utilis√©es dans le script) -->
  <input
    type="hidden"
    id="heuresMensuellesPSU"
    name="heuresMensuellesPSU"
  >

  <!-- Heures micro-cr√®che : affich√©es aux parents -->
  <label for="heuresMensuellesMicro" class="form-label mt-2 poppins-regular-simucmg">
    Heures mensuelles micro-cr√®che PAJE (base 52 sem.)
  </label>
  <input
    type="number"
    class="simu-auto-control"
    id="heuresMensuellesMicro"
    name="heuresMensuellesMicro"
    readonly
    step="0.01"
  >
</div>

 <p class="poppins-regular-simucmg mb-3">
     <strong>Le taux horaire CMG 2025 sert de plafond pour le calcul de l‚Äôaide, afin que le montant vers√© aux parents soit proportionnel aux heures r√©ellement travaill√©es, rendant l‚Äôaide plus √©quitable et adapt√©e √† chaque famille.</strong>
    </p>

  <!-- Taux horaire complet (calcul√©) -->
      <div class="col-md-6 mb-3">
        <label for="tauxComplet" class="form-label poppins-regular-simucmg">Taux horaire complet CMG (‚Ç¨)</label>
        <input type="text" class="simu-auto-control" id="tauxComplet" name="tauxComplet" readonly>
        <div id="alertePlafondCMG" class="alert alert-warning mt-2 d-none"></div>
      </div>



 <p class="poppins-regular-simucmg mb-3">
     <strong>Ne vous fiez pas au salaire net affich√© : apr√®s d√©duction des aides de la CAF et du cr√©dit d‚Äôimp√¥t, le co√ªt mensuel pour une assistante maternelle est g√©n√©ralement proche de celui d‚Äôune cr√®che.</strong>
    </p>


  <!-- Salaire net mensuel (calcul√©) -->
      <div class="col-md-6">
        <label for="salaireNet" class="form-label poppins-regular-simucmg">Salaire net mensuel (‚Ç¨)</label>
      <input type="text" class="simu-auto-control" id="salaireNet" name="salaireNet" readonly>
      </div>


    </div>
  </div>
</div>


        </div>
      </div>


</div> <!-- Fin de la carte 1 -->
</div> <!-- Fin du row -->
</div> <!-- Fin du container -->
</section> <!-- Fermeture de la section comparer-creche-assistante-maternelle -->











<div class="svg-banniere-background">
     <div class="svg-container">
    <img src="{{ '/images/simulateur/nuage-simu-exemples-pc.svg' | url }}" 
         class="nuages-bleus-curvy pc-svg" 
         alt="Illustration de nuages pour la pr√©sentation des exemples de contrats types sur PC"
         loading="lazy">
    
    <img src="{{ '/images/simulateur/nuage-simu-exemples-mobile.svg' | url }}" 
         class="nuages-bleus-curvy mobile-svg" 
         alt="Illustration de nuages pour la pr√©sentation des exemples de contrats types sur mobile"
         loading="lazy">
</div>






<section id="exemples-cout-reel-assistante-maternelle">
  <div class="container-service container-md">
    <h2 class="poppins-bold-service-title mb-5">EXEMPLES CONCRETS</h2>
 <h3 class="poppins-regular-simucmg mb-5">√Ä contrat √©quivalent et pour un accueil personnalis√© et promenades journali√®res, le montant du reste √† charge d√©pend de la situation de chaque famille (revenus, nombre d‚Äôenfants √† charge, etc.)</h3>
    <div class="row gy-4">
      <!-- Carte 1 -->
      <div class="col-12">
        <div class="comparatif-card h-100 p-4">
          <h3 class="fs-5 fw-bold poppins-regular d-flex align-items-center mb-3">
            <span class="comparatif-icon-wrapper me-2">
              <img src="{{ '/images/faq/book-and-magnifying-glass-svgrepo-com.svg' | url }}" class="bien-etre-icon" alt="Ic√¥ne communication" loading="lazy">
            </span>
            Exemple
          </h3>
          <ul class="poppins-regular-comparatif">
        
           <li><strong>Contrat en ann√©e compl√®te - 52s sur 4 jours - tarif 2025</strong></li>
            <li>En couple</li>
            <li>Ressources annuelles 2023 (‚Ç¨): 38000‚Ç¨.</li>
            <li>Nombre d‚Äôenfants √† charge: 2.</li>
            <li>Heures de garde par semaine: 45h.</li>
            <li>Taux horaire net (‚Ç¨): 4,28.</li>
            <li>Indemnit√© d'entretien (‚Ç¨ / mois): 5,35‚Ç¨ X 18 jours = 96,3‚Ç¨.</li>
            <li>Indemnit√© de repas (‚Ç¨ / mois): 5,45‚Ç¨ X 18 jours = 98,1‚Ç¨.</li>
            <li><strong>Reste √† charge Assistante Maternelle : 347‚Ç¨.</strong></li>
            <li><strong>Le reste √† charge est comparable √† celui d'une cr√®che PSU (Prestation de Service Unique).</strong></li>
          </ul>
        </div>
      </div>

      <!-- Carte 2 -->
      <div class="col-12">
        <div class="comparatif-card h-100 p-4">
          <h3 class="fs-5 fw-bold poppins-regular d-flex align-items-center mb-3">
            <span class="comparatif-icon-wrapper me-2">
              <img src="{{ '/images/faq/book-and-magnifying-glass-svgrepo-com.svg' | url }}" class="bien-etre-icon" alt="Ic√¥ne communication" loading="lazy">
            </span>
            Exemple
          </h3>
          <ul class="poppins-regular-comparatif">
           <li><strong>Contrat en ann√©e compl√®te - 52s sur 4 jours - tarif 2025</strong></li>
            <li>En couple</li>
            <li>Ressources annuelles 2023 (‚Ç¨): 70000‚Ç¨.</li>
            <li>Nombre d‚Äôenfants √† charge: 1.</li>
            <li>Heures de garde par semaine: 45h.</li>
            <li>Taux horaire net (‚Ç¨): 4,28.</li>
            <li>Indemnit√© d'entretien (‚Ç¨ / mois): 5,35‚Ç¨ X 18 jours = 96,3‚Ç¨.</li>
            <li>Indemnit√© de repas (‚Ç¨ / mois): 5,45‚Ç¨ X 18 jours = 98,1‚Ç¨.</li>
            <li><strong>Reste √† charge Assistante Maternelle : 782‚Ç¨.</strong></li>
            <li><strong>La diff√©rence mensuelle avec le reste √† charge de la cr√®che PSU est de seulement 78‚Ç¨ et vous b√©n√©ficiez d'un accueil premium personnalis√©.</strong></li>
          </ul>
        </div>
      </div>

      <!-- Carte 3 -->
      <div class="col-12">
        <div class="comparatif-card h-100 p-4">
          <h3 class="fs-5 fw-bold poppins-regular d-flex align-items-center mb-3">
            <span class="comparatif-icon-wrapper me-2">
              <img src="{{ '/images/faq/book-and-magnifying-glass-svgrepo-com.svg' | url }}" class="bien-etre-icon" alt="Ic√¥ne communication" loading="lazy">
            </span>
            Exemple
          </h3>
          <ul class="poppins-regular-comparatif">
            <li><strong>Contrat en ann√©e compl√®te - 52s sur 4 jours - tarif 2025</strong></li>
            <li>En couple</li>
            <li>Ressources annuelles 2023 (‚Ç¨): 90800‚Ç¨.</li>
            <li>Nombre d‚Äôenfants √† charge: 2.</li>
            <li>Heures de garde par semaine: 45h.</li>
            <li>Taux horaire net (‚Ç¨): 4,28.</li>
            <li>Indemnit√© d'entretien (‚Ç¨ / mois): 5,35‚Ç¨ X 18 jours = 96,3‚Ç¨.</li>
            <li>Indemnit√© de repas (‚Ç¨ / mois): 5,45‚Ç¨ X 18 jours = 98,1‚Ç¨.</li>
            <li><strong>Reste √† charge Assistante Maternelle : 828‚Ç¨.</strong></li>
            <li><strong>Vous b√©n√©ficiez d'un maintien de CMG de 201‚Ç¨, votre situation ne change pas avec la nouvelle reforme CMG.</strong></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>



<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>




<script>
  const seuilsCMG = {
    couple: [53119, 60659, 68119],
    mono: [74367, 84923, 95479]
  };

  const majorationParEnfant = {
    couple: 7540,
    mono: 10556
  };

// üëâ Ensuite on ajoute (si condition) le comparatif CMG AVANT le reste du contenu
const anciensBar√®mesCMG = {
  1: [
    { seuil: 23903, montant: 529.28 },
    { seuil: 53119, montant: 333.75 },
    { seuil: Infinity, montant: 200.22 }
  ],
  2: [
    { seuil: 27295, montant: 529.28 },
    { seuil: 60659, montant: 333.75 },
    { seuil: Infinity, montant: 200.22 }
  ],
  3: [
    { seuil: 30687, montant: 529.28 },
    { seuil: 68199, montant: 333.75 },
    { seuil: Infinity, montant: 200.22 }
  ],
  4: [
    { seuil: 34079, montant: 529.28 },
    { seuil: 75739, montant: 333.75 },
    { seuil: Infinity, montant: 200.22 }
  ]
};

function getAncienCMG(nbEnfants, revenu) {
  const bareme = anciensBar√®mesCMG[Math.min(nbEnfants, 4)];
  return bareme.find(bracket => revenu <= bracket.seuil).montant;
}


  const seuilsHeures = {
    "0-3": 100,
    "3-6": 50,
    "fratrie-0-3": 150,
    "fratrie-3-6": 100
  };

  function calculSimulation(data) {
      const {
    situation,
    nbEnfants,
    handicap,
    revenuAnnuel,
    heuresMensuelles,
    tauxHoraireNet,
    salaireNet,
    indemEntretien,
    indemRepas,
    heuresMensuellesPSU,
    heuresMensuellesMicro
  } = data;


   const hPSU = Number(heuresMensuellesPSU) || 0;
const hMicro = Number(heuresMensuellesMicro) || 0;
const heuresHebdoMicro = hMicro / 4.333;

    const salaireComplet = salaireNet + indemEntretien + indemRepas;
    const tauxComplet = (salaireComplet * tauxHoraireNet) / salaireNet;
    const coutRef = 4.85;

    let tauxEffort;
    if (handicap && nbEnfants > 1) {
      tauxEffort = [0.000516, 0.000413, 0.000310, 0.000206][nbEnfants - 2];
    } else {
      const tableEffort = [0.000619, 0.000516, 0.000413, 0.000310];
      tauxEffort = nbEnfants >= 8 ? 0.000206 : tableEffort[Math.min(nbEnfants - 1, 3)];
    }

    const TEH = (tauxComplet / coutRef) * tauxEffort * 100;
    const revenusMensuels = revenuAnnuel / 12;
    const cmgRemunerationReduit = revenusMensuels > 8500;
    const resteChargeHoraire = (revenusMensuels * TEH) / 100;
    const resteChargeAssmat = resteChargeHoraire * heuresMensuelles;

    let resteChargeAssmatPlafonne;
if (salaireComplet && salaireComplet > 0) {
  resteChargeAssmatPlafonne = Math.min(resteChargeAssmat, salaireComplet);
} else {
  resteChargeAssmatPlafonne = Math.max(resteChargeAssmat, 0);
}

    const heuresHebdo = heuresMensuelles / 4.333;

    const tarifsCeline = [
      [25, 9.69], [26, 9.32], [27, 8.97], [28, 8.66], [29, 8.35],
      [30, 8.08], [31, 7.82], [32, 7.57], [33, 7.35], [34, 7.12],
      [35, 6.92], [36, 6.73], [37, 6.54], [38, 6.38], [39, 6.22],
      [40, 6.05], [41, 5.90], [42, 5.77], [43, 5.64], [44, 5.50],
      [45, 5.38], [46, 5.22], [Infinity, 5.22]
    ];

    const tarifCeline = Number.isFinite(heuresHebdo)
      ? (tarifsCeline.find(([limite]) => heuresHebdo < limite)?.[1] ?? 0)
      : 0;

    const coutAssmat = tarifCeline * heuresMensuelles;

const cmgAssmatCeline = cmgRemunerationReduit
  ? 0
  : Math.max(0, salaireComplet - resteChargeAssmat);


    const resteChargeAssmatCeline = Math.min(coutAssmat - cmgAssmatCeline, salaireComplet);



   const tarifsMicro = {
  1: [[25, 9.90], [35, 9.50], [40, 9.00], [50, 8.50], [Infinity, 8.00]],
  2: [[25, 10.00], [35, 9.60], [40, 9.10], [50, 8.60], [Infinity, 8.10]],
  3: [[25, 10.20], [35, 9.80], [40, 9.30], [50, 8.80], [Infinity, 8.30]]
};


const seuilsCMGMicroCreche = {
  1: [23903, 53119],  // 1 enfant √† charge
  2: [27295, 60659],  // 2 enfants
  3: [30687, 68199],  // 3 enfants
  extraParEnfant: [3392, 7540]  // [tranche1, tranche2]
};

function determineTrancheMicroCreche(revenuAnnuel, nbEnfants) {
  const baseTranche1 = seuilsCMGMicroCreche[nbEnfants]?.[0] ?? 
                       seuilsCMGMicroCreche[3][0] + (nbEnfants - 3) * seuilsCMGMicroCreche.extraParEnfant[0];
  const baseTranche2 = seuilsCMGMicroCreche[nbEnfants]?.[1] ?? 
                       seuilsCMGMicroCreche[3][1] + (nbEnfants - 3) * seuilsCMGMicroCreche.extraParEnfant[1];

  if (revenuAnnuel <= baseTranche1) return 1;
  else if (revenuAnnuel <= baseTranche2) return 2;
  else return 3;
}

// D√©termination de la tranche en micro-cr√®che (selon revenu et nb enfants)
const tranche = determineTrancheMicroCreche(revenuAnnuel, nbEnfants);



 const tarifMC = tarifsMicro[tranche].find(([limite]) => heuresHebdoMicro <= limite)[1];
let coutMC;
const prixAccueilSaisi = parseFloat(document.getElementById("prixAccueil")?.value);

if (checkboxPrixManuel.checked && !isNaN(prixAccueilSaisi)) {
  coutMC = prixAccueilSaisi;
} else {
  coutMC = tarifMC * hMicro;
}



    const plafonds = { 1: 984.26, 2: 848.47, 3: 712.72 };
    const cmgMC = Math.min(coutMC * 0.85, plafonds[tranche]);
    const resteChargeMC = coutMC - cmgMC;

    const tarifHorairePSU = revenusMensuels * tauxEffort;
    const resteChargePSU = tarifHorairePSU * heuresMensuelles;

    return {
      resteAssmat: Math.round(resteChargeAssmatPlafonne),
      resteMicroCreche: Math.round(resteChargeMC),
      resteCrechePSU: Math.round(resteChargePSU),
      cmgAssmat: Math.round(cmgAssmatCeline),
      cmgMicroCreche: Math.round(cmgMC),
      tauxHoraireComplet: tauxComplet.toFixed(2),
      tauxEffortPourcent: TEH.toFixed(4)
    };
  }

  const heuresHebdoInput = document.getElementById("heuresHebdo");
  const heuresMensuellesInput = document.getElementById("heuresMensuelles");
  const tauxHoraireInput = document.getElementById("tauxHoraire");
  const salaireNetInput = document.getElementById("salaireNet");
  const indemEntretienInput = document.getElementById("indemEntretien");
const indemRepasInput = document.getElementById("indemRepas");
 const semainesParAnSelect = document.getElementById("semainesParAn");


function updateTauxComplet() {
  const heuresHebdo = parseFloat(document.getElementById("heuresHebdo").value) || 0;
  const salaireNet = parseFloat(document.getElementById("salaireNet").value) || 0;
  const indemEntretien = parseFloat(document.getElementById("indemEntretien").value) || 0;
  const indemRepas = parseFloat(document.getElementById("indemRepas").value) || 0;
  const tauxHoraireNet = parseFloat(document.getElementById("tauxHoraire").value) || 0;
  const semainesParAn = parseInt(semainesParAnSelect.value, 10) || 0;

  // Calculs PSU (bas√© sur semaines choisies) et micro (toujours 52 sem.)
  const heuresMensuellesPSU = (heuresHebdo * semainesParAn) / 12;
  const heuresMensuellesMicro = (heuresHebdo * 52) / 12;

  document.getElementById("heuresMensuellesPSU").value = heuresMensuellesPSU.toFixed(2);
  document.getElementById("heuresMensuellesMicro").value = heuresMensuellesMicro.toFixed(2);

  const salaireComplet = salaireNet + indemEntretien + indemRepas;
  let tauxComplet = 0;
  if (salaireNet > 0) {
    tauxComplet = (salaireComplet * tauxHoraireNet) / salaireNet;
  }
  // Plafonnement affichage √† 7,99
  if (tauxComplet > 7.99) {
    tauxComplet = 7.99;
  }
  document.getElementById("tauxComplet").value = tauxComplet.toFixed(2);

  // Message alerte
  const alerte = document.getElementById("alertePlafondCMG");
  if ((salaireNet > 0) && ((salaireComplet * tauxHoraireNet) / salaireNet > 7.99)) {
    alerte.textContent = "Le plafond CMG de 8‚ÄØ‚Ç¨/h est atteint. Le CMG reste vers√©, seule la part au-del√† du plafond reste √† votre charge. Pour une estimation exacte, consultez le simulateur officiel URSSAF (notre simulateur ne prend pas en compte les montants au-del√† du plafond).";
    alerte.classList.remove("d-none");
  } else {
    alerte.textContent = "";
    alerte.classList.add("d-none");
  }
}


  function updateHeuresMensuellesEtSalaire() {
    const heuresHebdo = parseFloat(heuresHebdoInput.value) || 0;
    const tauxHoraire = parseFloat(tauxHoraireInput.value) || 0;
    const semainesParAn = parseInt(semainesParAnSelect.value, 10) || 0;

 // Calcul des heures mensuelles proportionnel aux semaines travaill√©es
  const heuresMensuelles = (heuresHebdo * semainesParAn) / 12;



  // Calcul du salaire net de base
  let salaireNet = (tauxHoraire * heuresHebdo * semainesParAn) / 12;

 

   

    heuresMensuellesInput.value = heuresMensuelles.toFixed(2);
    salaireNetInput.value = salaireNet.toFixed(2);
    updateTauxComplet();
  }

  heuresHebdoInput.addEventListener("input", updateHeuresMensuellesEtSalaire);
  tauxHoraireInput.addEventListener("input", updateHeuresMensuellesEtSalaire);
   semainesParAnSelect.addEventListener("change", updateHeuresMensuellesEtSalaire);

  indemEntretienInput.addEventListener("input", updateTauxComplet);
indemRepasInput.addEventListener("input", updateTauxComplet);

  const form = document.getElementById("simulateur-form");
  const resultBox = document.getElementById("result-box");
  const barometre = document.getElementById("barometre-wrapper");
 const curseur = document.getElementById("curseur");

 

form.addEventListener("submit", function (e) {
  e.preventDefault();

  const tauxCompletAffiche = parseFloat(document.getElementById("tauxComplet").value);
  const alerte = document.getElementById("alertePlafondCMG");

  if (tauxCompletAffiche >= 7.99) {
    if (alerte) {
      alerte.textContent =
        "‚ö†Ô∏è Le plafond CMG de 8‚ÄØ‚Ç¨/h est atteint. Le CMG reste vers√©, seule la part au-del√† du plafond reste √† votre charge. Pour une estimation exacte, consultez le simulateur officiel URSSAF (notre simulateur ne prend pas en compte les montants au-del√† du plafond).";

      alerte.classList.remove("d-none");
      alerte.classList.add("alert", "alert-warning", "visible");

      // Scroll vers l'alerte automatiquement
      alerte.scrollIntoView({
        behavior: "smooth",
        block: "center"
      });

      // Accessibilit√© : focus sur l'alerte
      alerte.setAttribute("tabindex", "-1");
      alerte.focus();
    }

    // Masquer les anciens r√©sultats
    resultBox.classList.add("d-none");
    resultBox.innerHTML = "";
    barometre.classList.add("d-none");
    return;
  } else {
    if (alerte) {
      alerte.textContent = "";
      alerte.classList.add("d-none");
      alerte.classList.remove("alert", "alert-warning", "visible");
    }
  }
  const typeFamille = document.querySelector("input[name='situation']:checked")?.value;
  const nbEnfants = parseInt(document.getElementById("nbEnfants").value, 10);
  const revenu = parseInt(document.getElementById("revenu").value, 10);
  const age = document.getElementById("ageEnfant").value;



  updateHeuresMensuellesEtSalaire();

  const heuresMensuelles = parseFloat(heuresMensuellesInput.value) || 0;

 const heuresMensuellesPSU = parseFloat(document.getElementById("heuresMensuellesPSU").value) || 0;
  const heuresMensuellesMicro = parseFloat(document.getElementById("heuresMensuellesMicro").value) || 0;


  const tauxHoraireNet = parseFloat(tauxHoraireInput.value) || 0;
  const salaireNet = parseFloat(salaireNetInput.value) || 0;
  const indemEntretien = parseFloat(document.getElementById("indemEntretien").value) || 0;
  const indemRepas = parseFloat(document.getElementById("indemRepas").value) || 0;
  const handicap = document.getElementById("handicap")?.checked || false;

  const baseSeuil = seuilsCMG[typeFamille][Math.max(0, Math.min(nbEnfants - 1, 2))] || 0;
  const enfantsSupp = Math.max(0, nbEnfants - 3);
  const seuilTotal = baseSeuil + (enfantsSupp * majorationParEnfant[typeFamille]);

  const revenuOK = revenu <= seuilTotal;
  const seuilHeures = seuilsHeures[age] || 0;
  const heuresOK = heuresMensuelles >= seuilHeures;
  const estGagnant = revenuOK && heuresOK;

 

  resultBox.classList.remove("d-none", "alert-success", "alert-warning", "alert-info");

 
  const resultats = calculSimulation({
    situation: typeFamille,
    nbEnfants,
    handicap,
    revenuAnnuel: revenu,
    heuresMensuelles,
    heuresMensuellesPSU,
  heuresMensuellesMicro,
    tauxHoraireNet,
    salaireNet,
    indemEntretien,
    indemRepas
    
  });

 const cmg = resultats.cmgAssmat;
const seuilCMG = { profil1: 200, profil2Min: 120 };
const restePSU = resultats.resteCrechePSU;
const resteMC = resultats.resteMicroCreche;
const resteAssmat = resultats.resteAssmat;

let profil;

if (
  (resteAssmat <= restePSU && cmg > seuilCMG.profil1 && estGagnant) ||
  (resteAssmat <= resteMC && cmg >= 529)
) {
  profil = 1; // profil optimal (fusionn√© avec ancien profil 2)
} else if (resteAssmat <= resteMC && cmg >= seuilCMG.profil2Min) {
  profil = 2; // aide partielle
} else {
  profil = 3; // aide standard
}








const contenuCommunHTML = `
  <em>Mais choisir une assistante maternelle agr√©√©e, c‚Äôest bien plus qu‚Äôune question de tarif</em><br><br>

  <ul>
    <li>Un cadre familial, rassurant et attentif aux besoins de chaque enfant</li>
    <li>Des √©changes quotidiens et une relation de confiance avec les parents</li>
    <li>Un accompagnement √©ducatif respectueux de vos choix et de vos valeurs</li>
    <li>Des temps de sociabilisation au Relais Petite Enfance et lors des sorties au parc</li>
    <li>Des promenades quotidiennes pour favoriser l‚Äô√©veil sensoriel et le lien √† la nature</li>
    <li>Contrairement aux grandes structures, je peux personnaliser l‚Äôaccueil selon votre enfant : si vous avez des pr√©f√©rences √©ducatives, je les prends en compte avec souplesse.</li>
  </ul>

  <strong>R√©duisez votre reste √† charge :</strong>
  <br><a href="https://chubert91assmat.netlify.app/posts/entreprises/cesu-prefinances/"
    class="btn btn-action-primary mt-3 d-inline-block">Je d√©couvre les CESU pr√©-financ√©s ! ‚Üí</a><br><br>

  Je pourrais vous en dire plus, mais le mieux est de laisser parler ceux qui m‚Äôont confi√© leur enfant : d√©couvrez leurs avis
  sur Google :
  <br><a href="https://chubert91assmat.netlify.app/#avis"
    class="btn btn-action-primary mt-3 d-inline-block"><span
      class="etoiles">&#9733;&#9733;&#9733;&#9733;&#9733;</span> 100% de parents satisfaits ‚Üí</a><br><br>

  N'h√©sitez pas √† me contacter pour discuter ensemble de votre situation :
  <br><a href="/contact/" class="btn btn-action-primary mt-3 d-inline-block">Discutons ensemble de vos besoins ‚Üí</a><br><br>
`;



function afficherMessageReforme(cmg, ancienCMG) {
  if (cmg > ancienCMG) {
    const gain = (cmg - ancienCMG).toFixed(2).replace('.', ',');
    return `
      <div class="alert alert-info" role="alert">
        <img src="{{ '/images/simulateur/gain-simulateur-bretigny.svg' | url }}" class="bien-etre-icon" alt="ic√¥ne tirelire">
        Gr√¢ce √† la r√©forme du CMG, vous b√©n√©ficiez d'une aide <strong>plus √©lev√©e</strong> que celle pr√©vue auparavant pour votre niveau de revenus et votre composition familiale.<br>
        <strong>Ancien CMG bar√®me 2025 :</strong> ${ancienCMG.toFixed(2)} ‚Ç¨<br>
        <strong>Nouveau CMG :</strong> ${cmg} ‚Ç¨<br>
        <strong>Soit +${gain}‚ÄØ‚Ç¨/mois d‚Äôaide suppl√©mentaire</strong> avec la r√©forme cmg 2025.
      </div><br>
    `;
  }
  return '';
}
















// Affichage selon le profil
if (profil === 1) {
   // R√©cup√®re les valeurs saisies
  const typeFamilleLibelle = document.querySelector('input[name="situation"]:checked').nextElementSibling.textContent;
  const nbEnfants = document.getElementById('nbEnfants').value;
  const revenu = document.getElementById('revenu').value;
  const heuresHebdo = document.getElementById('heuresHebdo').value;
  const semainesParAn = document.getElementById('semainesParAn').options[document.getElementById('semainesParAn').selectedIndex].text;
  const tauxHoraire = document.getElementById('tauxHoraire').value;
  const indemEntretien = document.getElementById('indemEntretien').value;
  const indemRepas = document.getElementById('indemRepas').value;

  // Construit le r√©capitulatif
  const recapSaisie = `
    <div class="recap-saisie mb-4">
    <div class="anti-coupure">
      <div class="html2pdf__page-break"></div>
      <h3>Vos donn√©es de simulation</h3>
    
      <ul class="list-unstyled">
        <li><strong>Situation familiale :</strong> ${typeFamilleLibelle}</li>
        <li><strong>Nombre d‚Äôenfants √† charge :</strong> ${nbEnfants}</li>
        <li><strong>Ressources annuelles :</strong> ${revenu} ‚Ç¨</li>
        <li><strong>Heures de garde par semaine :</strong> ${heuresHebdo}</li>
        <li><strong>Type de contrat :</strong> ${semainesParAn}</li>
        <li><strong>Taux horaire net :</strong> ${tauxHoraire} ‚Ç¨</li>
        <li><strong>Indemnit√© d‚Äôentretien :</strong> ${indemEntretien} ‚Ç¨/mois</li>
        <li><strong>Indemnit√© de repas :</strong> ${indemRepas} ‚Ç¨/mois</li>
      </ul>
    </div>
    </div>
  `;

  // Injecte le r√©capitulatif + le r√©sultat
  resultBox.classList.add("result-profil-1");
  resultBox.classList.add("poppins-regular-simucmg");
  resultBox.innerHTML = recapSaisie + `


    Vous √™tes <strong>√©ligible</strong> √† un <strong>CMG tr√®s avantageux</strong> permettant un reste √† charge comparable ou identique √† celui d'une cr√®che subventionn√©e.<br><br>
    <strong>Estimation (avant cr√©dit d'imp√¥t):</strong><br>

<span class="bullet-dot bullet-green"></span>Reste √† charge Cr√®che PSU : <strong>${restePSU} ‚Ç¨</strong><br>
<span class="bullet-dot"></span>Reste √† charge Assistante Maternelle : <strong>${resteAssmat} ‚Ç¨</strong><br>
<span class="bullet-dot bullet-orange"></span>Reste √† charge Micro-cr√®che PAJE : <strong>${resteMC} ‚Ç¨</strong> <em>(Estimation moyenne locale ‚Äì √† confirmer avec la cr√®che sauf si vous avez saisi un devis.)</em><br><br>


 <em>Gr√¢ce √† ce niveau d‚Äôaide, vous pouvez choisir la solution la plus adapt√©e √† votre famille, sans contrainte de budget.</em><br><br>


    <strong>CMG Mensuel :</strong><br>

    <img src="{{ '/images/faq/money-bag-svgrepo-com.svg' | url }}" class="checked-money" alt="ic√¥ne tirelire">
    Assistante Maternelle : <strong>${cmg} ‚Ç¨</strong><br>

    <img src="{{ '/images/faq/money-bag-svgrepo-com.svg' | url }}" class="checked-money" alt="ic√¥ne tirelire">
    Micro-cr√®che PAJE : <strong>${resultats.cmgMicroCreche} ‚Ç¨</strong><br><br>




    <em>Ce niveau d‚Äôaide vous permet de profiter d‚Äôun accueil de qualit√© avec un tarif particuli√®rement comp√©titif chez une assistante maternelle agr√©√©e.</em>
  `;


// Calcul ancien CMG
const ancienCMG = getAncienCMG(nbEnfants, revenu);
const messageReforme = afficherMessageReforme(cmg, ancienCMG);
resultBox.innerHTML += messageReforme;

document.getElementById("btn-pdf").classList.remove("d-none");
document.getElementById("btn-reset").classList.remove("d-none");


} else if (profil === 2) {
  // R√©cup√®re les valeurs saisies
  const typeFamilleLibelle = document.querySelector('input[name="situation"]:checked').nextElementSibling.textContent;
  const nbEnfants = document.getElementById('nbEnfants').value;
  const revenu = document.getElementById('revenu').value;
  const heuresHebdo = document.getElementById('heuresHebdo').value;
  const semainesParAn = document.getElementById('semainesParAn').options[document.getElementById('semainesParAn').selectedIndex].text;
  const tauxHoraire = document.getElementById('tauxHoraire').value;
  const indemEntretien = document.getElementById('indemEntretien').value;
  const indemRepas = document.getElementById('indemRepas').value;

  // Construit le r√©capitulatif
  const recapSaisie = `
    <div class="recap-saisie mb-4">
        <div class="anti-coupure">
     <div class="html2pdf__page-break"></div>
      <h3>Vos donn√©es de simulation</h3>
     
      <ul class="list-unstyled">
        <li><strong>Situation familiale :</strong> ${typeFamilleLibelle}</li>
        <li><strong>Nombre d‚Äôenfants √† charge :</strong> ${nbEnfants}</li>
        <li><strong>Ressources annuelles :</strong> ${revenu} ‚Ç¨</li>
        <li><strong>Heures de garde par semaine :</strong> ${heuresHebdo}</li>
        <li><strong>Type de contrat :</strong> ${semainesParAn}</li>
        <li><strong>Taux horaire net :</strong> ${tauxHoraire} ‚Ç¨</li>
        <li><strong>Indemnit√© d‚Äôentretien :</strong> ${indemEntretien} ‚Ç¨/mois</li>
        <li><strong>Indemnit√© de repas :</strong> ${indemRepas} ‚Ç¨/mois</li>
      </ul>
    </div>
    </div>
  `;

  // Injecte le r√©capitulatif + le r√©sultat
  resultBox.classList.add("result-profil-2");
  resultBox.classList.add("poppins-regular-simucmg");
  resultBox.innerHTML = recapSaisie + `

   Le CMG auquel vous avez droit repr√©sente une aide cons√©quente pour faciliter l‚Äôaccueil de votre enfant. 
    Vous b√©n√©ficiez d‚Äôune aide partielle mais significative pour avoir acc√®s √† un accueil personnalis√©.<br><br>
    <strong>Estimation (avant cr√©dit d'imp√¥t) :</strong><br>

<span class="bullet-dot bullet-green"></span>Reste √† charge Cr√®che PSU : <strong>${restePSU} ‚Ç¨</strong><br>
<span class="bullet-dot"></span>Reste √† charge Assistante Maternelle : <strong>${resteAssmat} ‚Ç¨</strong><br>
<span class="bullet-dot bullet-orange"></span>Reste √† charge Micro-cr√®che PAJE : <strong>${resteMC} ‚Ç¨</strong> <em>(Estimation moyenne locale ‚Äì √† confirmer avec la cr√®che sauf si vous avez saisi un devis.)</em><br><br>


 <em>Vous pouvez ainsi choisir la solution la plus adapt√©e √† votre famille, selon vos priorit√©s.</em><br><br>

    <strong>CMG Mensuel :</strong><br>

    <img src="{{ '/images/faq/money-bag-svgrepo-com.svg' | url }}" class="checked-money" alt="ic√¥ne tirelire">
    Assistante Maternelle : <strong>${cmg} ‚Ç¨</strong><br>

    <img src="{{ '/images/faq/money-bag-svgrepo-com.svg' | url }}" class="checked-money" alt="ic√¥ne tirelire">
    Micro-cr√®che PAJE : <strong>${resultats.cmgMicroCreche} ‚Ç¨</strong><br><br>



  `;

// Calcul ancien CMG
const ancienCMG = getAncienCMG(nbEnfants, revenu);
const messageReforme = afficherMessageReforme(cmg, ancienCMG);
resultBox.innerHTML += messageReforme;


document.getElementById("btn-pdf").classList.remove("d-none");
document.getElementById("btn-reset").classList.remove("d-none");



} else if (profil === 3) {
  // R√©cup√®re les valeurs saisies
  const typeFamilleLibelle = document.querySelector('input[name="situation"]:checked').nextElementSibling.textContent;
  const nbEnfants = document.getElementById('nbEnfants').value;
  const revenu = document.getElementById('revenu').value;
  const heuresHebdo = document.getElementById('heuresHebdo').value;
  const semainesParAn = document.getElementById('semainesParAn').options[document.getElementById('semainesParAn').selectedIndex].text;
  const tauxHoraire = document.getElementById('tauxHoraire').value;
  const indemEntretien = document.getElementById('indemEntretien').value;
  const indemRepas = document.getElementById('indemRepas').value;

  // Construit le r√©capitulatif
  const recapSaisie = `
    <div class="recap-saisie mb-4">
        <div class="anti-coupure">
     <div class="html2pdf__page-break"></div>
      <h3>Vos donn√©es de simulation</h3>
     
      <ul class="list-unstyled">
        <li><strong>Situation familiale :</strong> ${typeFamilleLibelle}</li>
        <li><strong>Nombre d‚Äôenfants √† charge :</strong> ${nbEnfants}</li>
        <li><strong>Ressources annuelles :</strong> ${revenu} ‚Ç¨</li>
        <li><strong>Heures de garde par semaine :</strong> ${heuresHebdo}</li>
        <li><strong>Type de contrat :</strong> ${semainesParAn}</li>
        <li><strong>Taux horaire net :</strong> ${tauxHoraire} ‚Ç¨</li>
        <li><strong>Indemnit√© d‚Äôentretien :</strong> ${indemEntretien} ‚Ç¨/mois</li>
        <li><strong>Indemnit√© de repas :</strong> ${indemRepas} ‚Ç¨/mois</li>
      </ul>
    </div>
    </div>
  `;

  // Injecte le r√©capitulatif + le r√©sultat
  resultBox.classList.add("result-profil-3");
  resultBox.classList.add("poppins-regular-simucmg");
  resultBox.innerHTML = recapSaisie + `


    <strong>Un accueil de qualit√© pour votre enfant, dans un cadre chaleureux et s√©curis√©</strong><br><br>
    
    <strong>Estimation (avant cr√©dit d'imp√¥t) :</strong><br>
    <span class="bullet-dot"></span>Reste √† charge Assistante Maternelle : <strong>${resteAssmat} ‚Ç¨</strong><br>






    
    <strong>CMG Mensuel :</strong><br>
    <img src="{{ '/images/faq/money-bag-svgrepo-com.svg' | url }}" class="checked-money" alt="ic√¥ne tirelire">
    Assistante Maternelle : <strong>${cmg} ‚Ç¨</strong><br>
    <img src="{{ '/images/faq/money-bag-svgrepo-com.svg' | url }}" class="checked-money" alt="ic√¥ne tirelire">
    <strong>Vous b√©n√©ficiez d'un cr√©dit d'imp√¥t.</strong><br><br>
  `;

  

const ancienCMG = getAncienCMG(nbEnfants, revenu);

if (cmg > ancienCMG) {
  const gain = (cmg - ancienCMG).toFixed(2).replace('.', ',');

  resultBox.innerHTML += `
    <div class="alert alert-info" role="alert">
      <img src="{{ '/images/simulateur/gain-simulateur-bretigny.svg' | url }}" class="bien-etre-icon" alt="ic√¥ne tirelire">
      Gr√¢ce √† la r√©forme du CMG, vous b√©n√©ficiez d'une aide <strong>plus √©lev√©e</strong> que celle pr√©vue auparavant pour votre niveau de revenus et votre composition familiale.<br>
      <strong>Ancien CMG bar√®me 2025 :</strong> ${ancienCMG.toFixed(2)} ‚Ç¨<br>
      <strong>Nouveau CMG :</strong> ${cmg} ‚Ç¨<br>
      <strong>Soit +${gain}‚ÄØ‚Ç¨/mois d‚Äôaide suppl√©mentaire</strong> avec la r√©forme cmg 2025.
    </div><br>
  `;
}
  }

  
resultBox.innerHTML += contenuCommunHTML;
document.getElementById("btn-pdf").classList.remove("d-none");
document.getElementById("btn-reset").classList.remove("d-none");



const minVal = Math.min(restePSU, resteMC);
const maxVal = Math.max(restePSU, resteMC);

let positionPercent = 0;
if (resteAssmat <= minVal) {
  positionPercent = 0;
} else if (resteAssmat >= maxVal) {
  positionPercent = 100;
} else {
  positionPercent = ((resteAssmat - minVal) / (maxVal - minVal)) * 100;
}

curseur.style.left = `${positionPercent}%`;
if (profil === 3) {
  barometre.classList.add("d-none");
} else {
  barometre.classList.remove("d-none");
  curseur.style.left = `${positionPercent}%`;
}

 

 // SCROLL AUTOMATIQUE VERS LA FEN√äTRE DE R√âSULTATS
  resultBox.scrollIntoView({
    behavior: "smooth",
    block: "center"
  });

});







function resetSimulation() {
  // Masque les r√©sultats et le barom√®tre
  document.getElementById("result-box").classList.add("d-none");
  document.getElementById("result-box").innerHTML = "";
  document.getElementById("barometre-wrapper").classList.add("d-none");

  // Masque les boutons d‚Äôaction
  document.getElementById("btn-pdf").classList.add("d-none");
  document.getElementById("btn-reset").classList.add("d-none");

  // R√©initialise le formulaire (vide tous les champs)
  document.getElementById("simulateur-form").reset();

  // ‚ûï Remise √† z√©ro manuelle des champs calcul√©s de #calculs-automatiques-assistante-maternelle
  document.getElementById("heuresMensuelles").value = "";
  document.getElementById("heuresMensuellesPSU").value = "";
  document.getElementById("heuresMensuellesMicro").value = "";
  document.getElementById("tauxComplet").value = "";
  document.getElementById("salaireNet").value = "";

  // Cache l‚Äôalerte du plafond CMG si visible
  const alertePlafond = document.getElementById("alertePlafondCMG");
  if (alertePlafond) {
    alertePlafond.classList.add("d-none");
    alertePlafond.textContent = "";
  }

  // Remet le curseur √† gauche
  const curseur = document.getElementById("curseur");
  if (curseur) {
    curseur.style.left = "0%";
  }

  // Coche d√©manuellement la case ¬´ Conna√Æt le prix d‚Äôaccueil ¬ª + cache champ saisie
  const prixAccueil = document.getElementById("prixAccueil");
  const checkboxPrix = document.getElementById("connaitPrixAccueil");
  const wrapperPrix = document.getElementById("prixAccueilWrapper");
  if (checkboxPrix && prixAccueil && wrapperPrix) {
    checkboxPrix.checked = false;
    prixAccueil.value = "";
    wrapperPrix.classList.add("d-none");
  }

  // Remonte en haut du formulaire pour une nouvelle saisie
  document.getElementById("simulateur-form").scrollIntoView({ behavior: "smooth" });
}









document.getElementById("btn-pdf").addEventListener("click", function () {
  const element = document.getElementById("result-box");

  console.log("Contenu √† exporter :", element.innerHTML); // Debug

  if (!element || element.classList.contains("d-none") || !element.innerHTML.trim()) {
    alert("Aucun r√©sultat √† exporter. Lancez d'abord une simulation.");
    return;
  }

 const opt = {
  margin: [5, 5, 5, 5],
  filename: 'estimation-CMG.pdf',
  image: { type: 'jpeg', quality: 0.95 },
  html2canvas: { 
    scale: 2,
    letterRendering: true,
    logging: true
  },
  jsPDF: { 
    unit: 'mm', 
    format: 'a4', 
    orientation: 'portrait' 
  },
  pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
};

// Force un "reflow" du DOM
element.offsetHeight;

setTimeout(() => {
  html2pdf().set(opt).from(element).save().catch(err => {
    console.error("Erreur lors de la g√©n√©ration du PDF :", err);
    alert("Erreur lors de la g√©n√©ration du PDF. Consultez la console.");
  });
}, 500);


});



document.getElementById("btn-reset").addEventListener("click", resetSimulation);

// ‚ûï Ton code ici
const checkboxPrixManuel = document.getElementById("connaitPrixAccueil");
const prixAccueilWrapper = document.getElementById("prixAccueilWrapper");

checkboxPrixManuel.addEventListener("change", () => {
  if (checkboxPrixManuel.checked) {
    prixAccueilWrapper.classList.remove("d-none");
  } else {
    prixAccueilWrapper.classList.add("d-none");
    document.getElementById("prixAccueil").value = ""; // üßº reset du champ personnalis√©
  }
});


</script>


